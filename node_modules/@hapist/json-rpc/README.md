# @hapist/json-rpc

> An implementation of the JSON-RPC 2.0 specification for building RPCs with hapi.js

[![Latest Version](https://badgen.now.sh/npm/v/@hapist/json-rpc)](https://www.npmjs.com/package/@hapist/json-rpc)
[![Node Engine](https://badgen.now.sh/npm/node/@hapist/json-rpc)](https://www.npmjs.com/package/@hapist/json-rpc)
[![Build Status](https://badgen.now.sh/circleci/github/hapist/json-rpc)](https://circleci.com/gh/hapist/json-rpc)
[![Codecov](https://badgen.now.sh/codecov/c/github/hapist/json-rpc)](https://codecov.io/gh/hapist/json-rpc)
[![License: MIT](https://badgen.now.sh/badge/license/MIT/green)](https://opensource.org/licenses/MIT)

## Installation

```bash
yarn add @hapist/json-rpc
```

## Examples

### Joi (Default)

```ts
import * as plugin from "@hapist/json-rpc";
import Joi from "@hapi/joi";

await server.register({
	plugin,
	options: {
		methods: [...],
		processor: {
			schema: Joi.object().keys({
				id: Joi.alternatives().try(Joi.number(), Joi.string()).required(),
				jsonrpc: Joi.string().allow("2.0").required(),
				method: Joi.string().required(),
				params: Joi.object(),
			}),
			validate(data: object, schema: object) {
				return Joi.validate(data, schema);
			},
		},
	},
});
```

### AJV

```ts
import * as plugin from "@hapist/json-rpc";
import Ajv from "ajv";

await server.register({
	plugin,
	options: {
		methods: [...],
		processor: {
			schema: {
				properties: {
					id: {
						type: ["number", "string"],
					},
					jsonrpc: {
						pattern: "2.0",
						type: "string",
					},
					method: {
						type: "string",
					},
					params: {
						type: "object",
					},
				},
				required: ["jsonrpc", "method", "id"],
				type: "object",
			},
			validate(data: object, schema: object) {
				try {
					const ajv = new Ajv({
						$data: true,
						extendRefs: true,
						removeAdditional: true,
					});

					ajv.validate(schema, data);

					return { value: data, error: ajv.errors !== null ? ajv.errorsText() : null };
				} catch (error) {
					return { value: null, error: error.stack };
				}
			},
	},
});
```

## Testing

```bash
yarn test
```

## Security

If you discover a security vulnerability within this package, please send an e-mail to hello@basecode.sh. All security vulnerabilities will be promptly addressed.

## Credits

-   [Brian Faust](https://github.com/faustbrian)
-   [All Contributors](../../../../contributors)

## License

[MIT](LICENSE) Â© [Brian Faust](https://basecode.sh)
