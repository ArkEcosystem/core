"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const authenticate_1 = require("./authenticate");
const config_1 = require("./config");
exports.plugin = {
    pkg: require("../package.json"),
    once: true,
    register(server, options = {}) {
        config_1.config.load(options);
        if (config_1.config.hasError()) {
            throw config_1.config.getError();
        }
        if (config_1.config.get("strategy") === "auth") {
            server.auth.scheme("whitelist", () => ({
                authenticate(request, h) {
                    return authenticate_1.authenticate(request, h);
                },
            }));
        }
        else {
            server.ext({
                type: "onRequest",
                async method(request, h) {
                    return authenticate_1.authenticate(request, h);
                },
            });
        }
    },
};
//# sourceMappingURL=index.js.map