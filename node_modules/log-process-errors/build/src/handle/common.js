"use strict";require("core-js/modules/es.promise");Object.defineProperty(exports,"__esModule",{value:true});exports.handleEvent=void 0;var _limit=require("../limit.js");
var _repeat=require("../repeat.js");
var _level=require("../level.js");
var _main=require("../error/main.js");
var _exit=require("../exit.js");

var _event=require("./event.js");


const handleEvent=async function({
opts,
name,
previousEvents,
mEmitLimitedWarning,
promise,
value,
nextRejected,
nextValue})
{
if((0,_limit.isLimited)({previousEvents,mEmitLimitedWarning,name,value})){
return;
}

const event=await(0,_event.getEvent)({
name,
promise,
value,
nextRejected,
nextValue});


if((0,_repeat.isRepeated)({event,previousEvents})){
return;
}

await logEvent({opts,name,event});

await(0,_exit.exitProcess)({name,opts});
};exports.handleEvent=handleEvent;

const logEvent=async function({opts,name,event}){
const{error,stack}=(0,_main.getError)({name,event});

const level=(0,_level.getLevel)({opts,name,error});

if(level==="silent"){
return;
}

(0,_main.addErrorPrint)({error,opts,level,name,stack});


await opts.log(error,level);
};
//# sourceMappingURL=common.js.map