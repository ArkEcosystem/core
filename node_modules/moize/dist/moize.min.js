!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).moize={})}(this,function(e){"use strict";var i=Object.prototype.hasOwnProperty,O=function(e){for(var n,t=0;t<(arguments.length<=1?0:arguments.length-1);t++)if((n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1])&&"object"==typeof n)for(var r in n)i.call(n,r)&&(e[r]=n[r]);return e},E=function(e){var n=e.length;if(!n)return[];if(1===n)return[e[0]];if(2===n)return[e[0],e[1]];if(3===n)return[e[0],e[1],e[2]];for(var t=new Array(n),r=0;r<n;r++)t[r]=e[r];return t},j=function(e,n){var r="function"==typeof n?n:function(i){return function(e,n){if(e.length!==n.length)return!1;for(var t=0,r=e.length;t<r;t++)if(!i(e[t],n[t]))return!1;return!0}}(e);return function(e,n){for(var t=0;t<e.length;t++)if(r(e[t],n))return t;return-1}},M=function(e,n){return e===n||e!=e&&n!=n},P=function(e,n,t){},q=function(e,n,t){for(var r=t;r--;)e[r+1]=e[r];e[0]=n},K=function(i){var o=j(i.isEqual,i.isMatchingKey);return function(t,n){var r=t.keys[0];t.values[0]=t.values[0].then(function(e){return i.onCacheHit(t,i,n),i.onCacheChange(t,i,n),e}).catch(function(e){var n=o(t.keys,r);throw~n&&(t.keys.splice(n,1),t.values.splice(n,1)),e})}};function y(a,e){if(a.isMemoized)return a;var n=e||{},t=n.isEqual,r=void 0===t?M:t,i=n.isMatchingKey,o=n.isPromise,u=void 0!==o&&o,c=n.maxSize,s=void 0===c?1:c,f=n.onCacheAdd,l=void 0===f?P:f,h=n.onCacheChange,p=void 0===h?P:h,g=n.onCacheHit,v=void 0===g?P:g,y=n.transformKey,d=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],0<=n.indexOf(t)||(i[t]=e[t]);return i}(n,["isEqual","isMatchingKey","isPromise","maxSize","onCacheAdd","onCacheChange","onCacheHit","transformKey"]),m=O({},d,{isEqual:r,isMatchingKey:i,isPromise:u,maxSize:s,onCacheAdd:l,onCacheChange:p,onCacheHit:v,transformKey:y}),x=j(r,i),C=K(m),S=!(!y&&!i),A={keys:[],get size(){return A.keys.length},values:[]},z=A.keys,b=A.values;function k(){var e=arguments,n=S?E(e):e,t=y?y(n):n,r=x(z,t);if(~r)v(A,m,k),r&&(q(z,z[r],r),q(b,b[r],r),p(A,m,k));else{z.length>=s&&(z.pop(),b.pop());var i=S?t:E(n),o=a.apply(this,e);q(z,i,z.length),q(b,o,b.length),u&&C(A,k),l(A,m,k),p(A,m,k)}return b[0]}return Object.defineProperties(k,{cache:{configurable:!0,get:function(){return A}},cacheSnapshot:{configurable:!0,get:function(){return{keys:E(A.keys),size:A.size,values:E(A.values)}}},isMemoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return m}}}),k}var d={equals:void 0,isDeepEqual:!1,isPromise:!1,isReact:!1,isSerialized:!1,matchesKey:void 0,maxAge:void 0,maxArgs:void 0,maxSize:1/0,onExpire:void 0,profileName:void 0,serializer:void 0,shouldSerializeFunctions:!1,transformArgs:void 0,updateExpire:!1},m=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length)return n.reduce(function(e,n){return"function"==typeof e?"function"==typeof n?function(){n.apply(this,arguments),e.apply(this,arguments)}:e:"function"==typeof n?n:void 0})},o=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length)return n.reduce(function(e,n){return"function"==typeof e?"function"==typeof n?function(){return e(n.apply(this,arguments))}:e:"function"==typeof n?n:void 0})},p=function(e,n){for(var t=0;t<e.length;t++)if(e[t].key===n)return t;return-1},g=function(r,e){var i="function"==typeof e?e:function(e,n){for(var t=0;t<n.length;t++)if(!r(e[t],n[t]))return!1;return!0};return function(e,n){for(var t=0;t<e.length;t++)if(e[t].length===n.length&&i(e[t],n))return t;return-1}},a=function(e){return Array.isArray(e)?e:[e]},x=function(e,n){return n===d?e:Object.assign({},e,n,{onCacheAdd:m(e.onCacheAdd,n.onCacheAdd),onCacheChange:m(e.onCacheChange,n.onCacheChange),onCacheHit:m(e.onCacheHit,n.onCacheHit),transformArgs:o(e.transformArgs,n.transformArgs)})},v=function(e,n,t){var r=p(e,n);~r&&(clearTimeout(e[r].timeoutId),t&&e.splice(r,1))},C=function(e,n,t,r){var i=n.maxAge,o=n.updateExpire,a="number"==typeof i&&isFinite(i)?function a(u,c,s,e){var n=c.maxAge,f=c.onCacheChange,l=c.onExpire,h=g(s,e);return function(t,r,i){var o=t.keys[0];if(!~p(u,o)){var e=function(){var e=h(t.keys,o),n=t.values[e];~e&&(t.keys.splice(e,1),t.values.splice(e,1),"function"==typeof f&&f(t,r,i)),v(u,o,!0),"function"==typeof l&&!1===l(o)&&(t.keys.unshift(o),t.values.unshift(n),a(u,c,s)(t,r,i),"function"==typeof f&&f(t,r,i))};u.push({expirationMethod:e,key:o,timeoutId:setTimeout(e,n)})}}}(e,n,t,r):void 0;return{onCacheAdd:a,onCacheHit:a&&o?function(r,e){var i=e.maxAge;return function(e){var n=e.keys[0],t=p(r,n);~t&&(v(r,n,!1),r[t].timeoutId=setTimeout(r[t].expirationMethod,i))}}(e,n):void 0}},u={anonymousProfileNameCounter:1,isCollectingStats:!1,profiles:{}},c=!1,n=function(){u.isCollectingStats=!0},S=function(e){var n=(new Error).stack,t=e.displayName||e.name||"Anonymous "+u.anonymousProfileNameCounter++;if(!n)return t;for(var r,i,o=n.split("\n").slice(3),a=0;a<o.length;a++)if(!~(r=o[a]).indexOf("/moize/")&&!~r.indexOf(" (native)")&&!~r.indexOf(" Function.")){i=r.replace(/\n/g,"\\n").trim();break}return i?t+" "+i:t},s=function(e,n){return e?(n/e*100).toFixed(4)+"%":"0%"},f=function t(e){if(u.isCollectingStats||c||(console.warn('Stats are not currently being collected, please run "collectStats" to enable them.'),c=!0),e){if(!u.profiles[e])return{calls:0,hits:0,usage:"0%"};var n=u.profiles[e];return Object.assign({},n,{usage:s(n.calls,n.hits)})}var r=Object.keys(u.profiles).reduce(function(e,n){return e.calls+=u.profiles[n].calls,e.hits+=u.profiles[n].hits,e},{calls:0,hits:0});return Object.assign({},r,{profiles:Object.keys(u.profiles).reduce(function(e,n){return e[n]=t(n),e},{}),usage:s(r.calls,r.hits)})},A=function(e){return u.isCollectingStats?{onCacheAdd:function(e){var n=e.profileName;return u.profiles[n]||(u.profiles[n]={calls:0,hits:0}),function(){u.profiles[n].calls++}}(e),onCacheHit:function(e){var n=e.profileName;return function(){u.profiles[n].calls++,u.profiles[n].hits++}}(e)}:{}},z=function(e,n){return function(i,e){var r=e.expirations,n=i.options,t=n.isEqual,o=n.isMatchingKey,a=n.onCacheAdd,u=n.onCacheChange,c=n.transformKey,s=g(t,o);i.add=function(e,n){var t=c?c(e):e;~s(i.cache.keys,t)||(i.cache.size>=i.options.maxSize&&(i.cache.keys.pop(),i.cache.values.pop()),i.cache.keys.unshift(t),i.cache.values.unshift(n),a(i.cache,i.options,i),u(i.cache,i.options,i))},i.clear=function(){i.cache.keys.length=0,i.cache.values.length=0,u(i.cache,i.options,i)},i.get=function(e){var n=s(i.cache.keys,c?c(e):e);return~n?i.apply(this,i.cache.keys[n]):void 0},i.getStats=function(){var e=i.options.profileName;return f(e)},i.has=function(e){return!!~s(i.cache.keys,c?c(e):e)},i.keys=function(){return i.cacheSnapshot.keys},i.remove=function(e){var n=s(i.cache.keys,c?c(e):e);if(~n){var t=i.cache.keys[n];i.cache.keys.splice(n,1),i.cache.values.splice(n,1),u(i.cache,i.options,i),v(r,t,!0)}},i.update=function(e,n){var t=s(i.cache.keys,c?c(e):e);if(~t){var r=i.cache.keys[t];q(i.cache.keys,r,t),q(i.cache.values,n,t),u(i.cache,i.options,i)}},i.values=function(){return i.cacheSnapshot.values}}(e,n),function(e,n){var t=n.expirations,r=n.options,i=n.originalFunction,o=e.options;Object.defineProperties(e,{_microMemoizeOptions:{configurable:!0,get:function(){return o}},expirations:{configurable:!0,get:function(){return t}},expirationsSnapshot:{configurable:!0,get:function(){return t.slice(0)}},isCollectingStats:{configurable:!0,get:function(){return u.isCollectingStats}},isMoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return r}},originalFunction:{configurable:!0,get:function(){return i}}}),r.isReact&&(e.contextTypes=i.contextTypes,e.defaultProps=i.defaultProps,e.displayName="Moized("+(i.displayName||i.name||"Component")+")",e.propTypes=i.propTypes)}(e,n),e},b="function"==typeof Map,k="function"==typeof Set,l="function"==typeof WeakSet,h=Object.keys,N=function(e,n){return e&&"object"==typeof e&&n.add(e)},H=function(e,n,t,r){for(var i,o=0;o<e.length;o++)if(t((i=e[o])[0],n[0],r)&&t(i[1],n[1],r))return!0;return!1},w=function(e,n,t,r){for(var i=0;i<e.length;i++)if(t(e[i],n,r))return!0;return!1},F=function(e,n){return e===n||e!=e&&n!=n},R=function(e){return e.constructor===Object},T=function(e){return"function"==typeof e.then},_=function(e){return!(!e.$$typeof||!e._store)},t=function(n){return function(e){var o=n||e;return function(e,n,t){void 0===t&&(t=l?new WeakSet:Object.create({_values:[],add:function(e){this._values.push(e)},has:function(e){return!!~this._values.indexOf(e)}}));var r=t.has(e),i=t.has(n);return r||i?r&&i:(N(e,t),N(n,t),o(e,n,t))}}},D=function(e){var t=[];return e.forEach(function(e,n){return t.push([n,e])}),t},I=function(e){var n=[];return e.forEach(function(e){return n.push(e)}),n},J=function(e,n,t,r){var i,o=h(e),a=h(n);if(o.length!==a.length)return!1;for(var u=0;u<o.length;u++){if(i=o[u],!w(a,i,F))return!1;if(("_owner"!==i||!_(e)||!_(n))&&!t(e[i],n[i],r))return!1}return!0},W=Array.isArray,r=function(e){var g="function"==typeof e?e(n):n;function n(e,n,t){if(F(e,n))return!0;var r=typeof e;if(r!=typeof n||"object"!=r||!e||!n)return!1;if(R(e)&&R(n))return J(e,n,g,t);var i=W(e),o=W(n);if(i||o)return i===o&&function(e,n,t,r){if(e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(!t(e[i],n[i],r))return!1;return!0}(e,n,g,t);var a=e instanceof Date,u=n instanceof Date;if(a||u)return a==u&&F(e.getTime(),n.getTime());var c=e instanceof RegExp,s=n instanceof RegExp;if(c||s)return c==s&&function(e,n){return e.source===n.source&&e.global===n.global&&e.ignoreCase===n.ignoreCase&&e.multiline===n.multiline&&e.unicode===n.unicode&&e.sticky===n.sticky&&e.lastIndex===n.lastIndex}(e,n);if(T(e)||T(n))return e===n;if(b){var f=e instanceof Map,l=n instanceof Map;if(f||l)return f==l&&function(e,n,t,r){var i=D(e),o=D(n);if(i.length!==o.length)return!1;for(var a=0;a<i.length;a++)if(!H(o,i[a],t,r)||!H(i,o[a],t,r))return!1;return!0}(e,n,g,t)}if(k){var h=e instanceof Set,p=n instanceof Set;if(h||p)return h==p&&function(e,n,t,r){var i=I(e),o=I(n);if(i.length!==o.length)return!1;for(var a=0;a<i.length;a++)if(!w(o,i[a],t,r)||!w(i,o[a],t,r))return!1;return!0}(e,n,g,t)}return J(e,n,g,t)}return n},$=(r(t()),r(t(F)),r()),B=r(function(){return F}),G=function(n){return function(e){if(n>=e.length)return e;switch(n){case 0:return[];case 1:return[e[0]];case 2:return[e[0],e[1]];case 3:return[e[0],e[1],e[2]];case 4:return[e[0],e[1],e[2],e[3]];case 5:return[e[0],e[1],e[2],e[3],e[4]]}return Array.prototype.slice.call(e,0,n)}},L=function(e,n,t){return"[ref-"+t+"]"},Q=function(e,n){for(var t=0;t<e.length;t++)if(e[t]===n)return t;return-1},U=function(t,e){var r,i,o=e||L,a="function"==typeof t,u=[];return function(e,n){if(u.length){if(~(r=Q(u,this))?u=function(e,n){for(var t=new Array(n),r=0;r<n;r++)t[r]=e[r];return t}(u,r+1):u[u.length]=this,~(i=Q(u,n)))return o.call(this,e,n,i)}else u[0]=n;return a?t.call(this,e,n):n}};var V=function(e,n){return"function"==typeof n?""+n:n},X=function(n,t){try{return JSON.stringify(n,t)}catch(e){return function(e,n,t,r){return JSON.stringify(e,U(n,r),t)}(n,t)}},Y=function(e){return"function"==typeof e.serializer?o(a,e.serializer):function(e){var a=e.shouldSerializeFunctions?V:null;return function(e){for(var n,t,r,i="|",o=0;o<e.length;o++)i+=(n=e[o],t=a,r=typeof n,(!n||"object"!=r&&"function"!=r?n:X(n,t))+"|");return[i]}}(e)},Z=function(e,n){return e[0]===n[0]},ee=function(r){if("function"==typeof r)return function(e,n,t){return r(t.cache,t.options,t)}},ne=function(e){var n=e.equals,t=e.isDeepEqual,r=e.isReact;return n||t&&$||r&&B||F},te=function(e){var n=e.isSerialized;return e.matchesKey||n&&Z||void 0},re=function(e){var n=e.maxArgs,t=e.isReact,r=e.isSerialized,i=e.transformArgs;return o(r&&Y(e),"function"==typeof i&&o(a,i),t&&G(2),"number"==typeof n&&G(n))};function ie(t,e){if(void 0===e&&(e=d),t.isMoized)return ie(t.originalFunction,x(t.options,e));if("object"==typeof t)return function(e,n){return void 0===n&&(n={}),"function"==typeof e?ie(e,x(t,n)):ie(x(t,e))};var n=Object.assign({},d,e,{maxArgs:"number"==typeof e.maxArgs&&0<=e.maxArgs?e.maxArgs:d.maxArgs,maxSize:"number"==typeof e.maxSize&&0<=e.maxSize?e.maxSize:d.maxSize,profileName:e.profileName||S(t)}),r=[],i=(n.equals,n.isDeepEqual,n.isPromise),o=(n.isReact,n.isSerialized,n.matchesKey,n.maxAge,n.maxArgs,n.maxSize),a=n.onCacheAdd,u=n.onCacheChange,c=n.onCacheHit,s=(n.onExpire,n.profileName,n.shouldSerializeFunctions,n.serializer,n.transformArgs,n.updateExpire,function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],0<=n.indexOf(t)||(i[t]=e[t]);return i}(n,["equals","isDeepEqual","isPromise","isReact","isSerialized","matchesKey","maxAge","maxArgs","maxSize","onCacheAdd","onCacheChange","onCacheHit","onExpire","profileName","shouldSerializeFunctions","serializer","transformArgs","updateExpire"])),f=ne(n),l=te(n),h=C(r,n,f,l),p=A(n),g=re(n),v=Object.assign({},s,{isEqual:f,isMatchingKey:l,isPromise:i,maxSize:o,onCacheAdd:ee(m(a,h.onCacheAdd,p.onCacheAdd)),onCacheChange:ee(u),onCacheHit:ee(m(c,h.onCacheHit,p.onCacheHit)),transformKey:g});return z(y(t,v),{expirations:r,options:n,originalFunction:t})}ie.collectStats=n,ie.compose=function(){return o.apply(null,arguments)||ie},ie.deep=ie({isDeepEqual:!0}),ie.getStats=f,ie.isCollectingStats=function(){return u.isCollectingStats},ie.isMoized=function(e){return"function"==typeof e&&!!e.isMoized},ie.maxAge=function(e){return ie({maxAge:e})},ie.maxArgs=function(e){return ie({maxArgs:e})},ie.maxSize=function(e){return ie({maxSize:e})},ie.promise=ie({isPromise:!0,updateExpire:!0}),ie.react=ie({isReact:!0}),ie.reactSimple=ie({isReact:!0,maxSize:1}),ie.serialize=ie({isSerialized:!0}),ie.simple=ie({maxSize:1}),e.collectStats=n,e.default=ie,Object.defineProperty(e,"__esModule",{value:!0})});
