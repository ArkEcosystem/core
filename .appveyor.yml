# Test against the latest version of this Node.js version
build: off

environment:
  nodejs_version: "10"
  
services:
  - postgresql101

# Install scripts. (runs after repo cloning)
install:
  # Get the latest stable version of Node.js or io.js
  - ps: Install-Product node $env:nodejs_version
  # install modules
  - npm install yarn -g

init:
  - SET PGUSER=postgres
  - SET PGPASSWORD=Password12!
  - SET PATH=C:\Program Files\PostgreSQL\10\bin\;%PATH%
  - psql --version

before_test:  
    - mkdir %HOME%\.ark\database
    - psql -c "CREATE DATABASE ark_development;" -U postgres
    - psql -c "CREATE USER ark WITH PASSWORD 'password';" -U postgres

# Post-install test scripts.
test_script:
  # Output useful info for debugging.
  - node --version
  - npm --version
  # run tests
  #- npm test
  - yarn global add lerna
  - lerna bootstrap 
  - ./node_modules/.bin/cross-env ARK_ENV=test ./node_modules/.bin/jest ./packagescore-webhooks/ ./packages/core-transaction-pool-mem/ ./packages/core-test-utils/ ./packages/core-p2p/ ./packages/core-json-rpc/ ./packages/core-forger/ ./packages/core-error-tracker-bugsnag/ ./packages/core-debugger-cli/ ./packages/core-container/ ./packages/core-api/ --detectOpenHandles --runInBand --forceExit --ci --coverage
  
